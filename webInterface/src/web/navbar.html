<!DOCTYPE html>
<div class="navbar-fixed" style="margin-bottom: 10px">
    <nav class="nav-extended">
        <div class="nav-wrapper">
            <a class="brand-logo" href="/">OpenCraft</a>
            <a class="sidenav-trigger" id="sidenav-trigger" data-target="slide-out"><i class="mdi mdi-24px mdi-menu" id="trigger"></i></a>
        </div>
        <div class="progress" id="prgs" style="margin-bottom: -3px;margin-top: -1px">
            <div class="indeterminate"></div>
        </div>
    </nav>
</div>

<ul id="slide-out" class="sidenav sidenav-fixed">
    <li><div class="user-view">
        <div class="background" style="background-color: #ee6e73"></div>
        <a class="circle white-text" id="face"></a>
        <a class="white-text name" id="name"></a>
        <a><span class="white-text email" id="gameID"></span></a>
    </div></li>
    <li><a class="waves-effect" id="nav-message"><i class="mdi mdi-message mdi-24px"></i>消息</a></li>
    <li><a class="waves-effect" id="nav-server"><i class="mdi mdi-server mdi-24px"></i>服务器</a></li>
</ul>

<script>
    navUpdate = () => {
        let name = $('#name');
        let id = $('#gameID');
        name.empty().append('同步中');
        updateUserData(function () {
            name.empty();
            id.empty();
            if (userData.r === 0){
                name.append(userData.nickname);
                id.append(userData.ID + "@minecraft");
            } else {
                name.append('点击以登录');
            }
            $('#face').empty().append(getFace());
        },function () {
            name.empty().append('点击以登录');
            id.empty().append('无法连接到服务器');
        });
    };

    let ele = $('.sidenav');
    M.Sidenav.init(ele,{
        onOpenStart: navUpdate
    });
    let sideNav = M.Sidenav.getInstance(ele);
    function switchPage(data){
        if (!isWideScreen())
            sideNav.close();
        setTimeout(function () {
            if (typeof onDisable === 'function')
                onDisable();
            fadeSwitch(data,document.getElementById('content'),true)
        },250)
    }


    $('#face').click(function () {
        switchPage(function (callback) {
            let target = "";
            if (userData.r === 0) target = 'ui?request=user';
            else target = 'ui?request=login';
            $('#content').load(target,callback);
        })
    });

    $('#nav-server').click(function () {
        switchPage((callback) => $('#content').load('ui?request=server',callback))
    });
    $('#nav-message').click(function () {
        switchPage((callback) => $('#content').load('ui?request=message',callback))
    })
</script>